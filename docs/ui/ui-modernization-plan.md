# UI Modernization Plan (UTab)

## 目的
- 旧来の見た目・操作感を刷新し、運営/参加者が迷わず操作できる UI に再設計する。
- 画面間の一貫性・可読性・アクセシビリティ・保守性を高め、将来の機能追加に耐える基盤を作る。
- 2言語対応を前提に、翻訳漏れやレイアウト崩れが起きない UI を設計する。

## 対象範囲
- `packages/web/src` の UI 実装全体
  - 共通 UI (`components/common/*`)
  - 結果・統計・スライド (`components/results/*`, `components/mstat/*`, `components/slides/*`)
  - 管理画面 (`views/admin/*`)
  - 参加者画面 (`views/user/*`)
  - グローバル CSS (`styles.css`)

## 非対象（今回はやらない）
- バックエンド API の仕様変更
- 認可/権限モデルの再設計
- ルーティング構造の大規模な変更（必要なら段階的に）

## 成功条件（抜粋）
- すべての主要フォーム/一覧が、共通 UI コンポーネントで統一されている
- 管理・参加者のナビが明確で迷わない（現在地が視覚的に分かる）
- 長いページが分割/折り畳み/検索で扱いやすくなっている
- 2言語表示で翻訳漏れがなく、言語切替で文言と日付/数値が整合する

## 最新進捗（2026-02-12）
- レポート生成画面に集計オプション、差分表示、提出状況サマリを統合済み。
- 差分表示は「アイコン + テキスト」で色依存を避ける方針に更新。
- 公開結果の安全性観点として、public compiled API では内部コンパイル情報を非表示化。
- Phase 4 では「後方互換回帰（旧リクエスト）」「CSV出力」「公開表示」の観点を優先して継続検証する。

## 最新進捗（2026-02-13）
- Phase 4 フォローとして、Ballot 送信の勝者必須条件（非同点時）と no-speaker-score 時の送信可否を再検証し、UI/API の挙動を一致化。
- 重複票の正規化を提出者単位に修正し、複数ジャッジ票を誤って1票扱いしない回帰観点を追加。
- UI QA チェックリストに、重複正規化・同順位維持・Ballot バリデーションの観点を追記。

---

## 全体進行イメージ（フェーズ分割）
1. 現状調査・インベントリ作成
2. デザイン基盤（デザインシステム/トークン）構築
3. 情報設計（ナビ/レイアウト）再設計
4. フォーム/一覧/表の再設計
5. データ視覚化の再設計
6. アクセシビリティ・品質検証・段階的リリース

---

## 詳細タスク分解と仕様
以下は「人に作業を依頼する」前提の詳細仕様。各タスクは単独で着手できる単位に分割する。

### タスク 1.1: 画面マップとユーザーフロー作成
- 目的: 現状の導線と画面関係を可視化し、改修の影響範囲を判断できるようにする。
- 仕様: 管理・参加者・認証（ログイン/登録）の3カテゴリで画面一覧を作成し、主要フロー（大会作成、ラウンド編集、結果確認、参加者ログイン）を矢印で示す。
- 成果物: `docs/ui-map.md` に画面一覧と簡易フロー図を記載。
- 完了条件: 全画面がカテゴリ別に列挙され、主要フローが1ページで追える。

### タスク 1.2: UI コンポーネント棚卸し
- 目的: 共通化対象と重複実装を特定する。
- 仕様: ボタン、入力、フォーム、カード、一覧、ナビ、表、チャート、スライドの使用箇所を列挙し、差分（サイズ/色/余白/文言）を記録する。
- 成果物: `docs/ui-inventory.md` にコンポーネント一覧と使用箇所を記載。
- 完了条件: 主要 UI パーツの重複パターンが把握できる。

### タスク 1.3: 問題点一覧と優先度付け
- 目的: 改修順序を明確にし、レビューの合意形成を行う。
- 仕様: 問題点を「操作性」「視認性」「一貫性」「アクセシビリティ」に分類し、P0〜P2の優先度を付与する。
- 成果物: `docs/ui-issues.md` に分類表を記載。
- 完了条件: 各問題に「場所・症状・優先度」が記載されている。

---

### タスク 2.1: デザイントークン定義
- 目的: 色・余白・角丸・影・フォントを統一して UI の一貫性を担保する。
- 仕様: `:root` に CSS 変数を追加し、色（primary/secondary/surface/border/text/muted/danger/warn/success）、余白（4/8/12/16/24/32/48）、角丸（6/8/12/16）、影（card/overlay）、フォーカスリング色を定義する。2言語向けにフォントファミリー（和文/欧文）と行間もトークン化する。
- 対象: `packages/web/src/styles.css`
- 完了条件: 主要色/余白/角丸/影が CSS 変数で参照できる。

### タスク 2.2: レイアウト基盤（Container/Stack/Section）
- 目的: 画面幅と余白のばらつきを解消し、読みやすいレイアウトを提供する。
- 仕様: `.page` と `.page-content` を追加し、最大幅（例: 1200px）と左右余白（16〜24px）を統一。`Stack` は垂直間隔、`Inline` は水平方向の整列に使用する。
- 対象: `packages/web/src/styles.css` と既存ビュー
- 完了条件: 全画面に最大幅が適用され、コンテンツの行長が適正になる。

### タスク 2.3: Button コンポーネント共通化
- 目的: ボタンの視認性・操作感・状態表現を統一する。
- 仕様: `Button` を `components/common` に追加し、`variant`（primary/secondary/ghost/danger）、`size`（sm/md/lg）、`loading`、`disabled` をサポート。高さは 36/40/44px。フォーカスリング対応。`loading` 時はラベル置換またはスピナー表示。
- 対象: `components/common/*` と各ビュー
- 完了条件: `.primary`/`.ghost` 直書きを撤去し、共通 `Button` に置換。

### タスク 2.4: Form Field コンポーネント共通化
- 目的: 入力ラベル/ヘルプ/エラー表示を一貫化し、アクセシビリティを改善する。
- 仕様: `Field` を追加し `label`、`help`、`error`、`required` をサポート。内部 input/textarea/select と `for/id` を紐付け。エラー時は境界色と補助文を表示。
- 対象: `components/common/*` とフォームを持つ全ビュー
- 完了条件: プレースホルダに依存しないフォームとなり、エラー表示が統一される。

### タスク 2.5: 表・一覧の基盤スタイル
- 目的: すべてのリスト/テーブルで見た目と操作が統一されるようにする。
- 仕様: `Table` スタイル（ヘッダー固定/行ホバー/ストライプ）と `List` スタイル（カード型/行型）を定義する。空状態用 `EmptyState` を共通化。
- 対象: `styles.css` と一覧を持つビュー
- 完了条件: 一覧/表の表示が統一され、空状態が明確になる。

---

### タスク 3.1: AppHeader のナビ改修
- 目的: 現在地の可視化とレスポンシブ対応を実現する。
- 仕様: 管理/参加者の現在リンクにアクティブスタイルを付与。狭幅ではナビを折り返しまたはメニューに切替。ユーザー名/ログアウトの配置を固定化。2言語切替がある場合はここに配置し、選択状態が明確になるようにする。
- 対象: `components/common/AppHeader.vue`
- 完了条件: 現在地が一目で分かり、モバイルでも崩れない。

### タスク 3.2: 管理画面 IA の再整理
- 目的: 管理画面の長大スクロールと情報の混在を解消する。
- 仕様: `AdminTournamentHome` を「基本情報」「参加者ログイン」「エンティティ管理」の3セクションに分割し、必要に応じて折り畳み。セクションごとに小見出しと説明を追加する。
- 対象: `views/admin/AdminTournamentHome.vue`
- 完了条件: 1画面が過度に長くならず、目的の設定に素早く到達できる。

### タスク 3.3: 参加者画面ナビの二言語対応
- 目的: 参加者向け画面で役割が直感的に理解できるようにする。
- 仕様: `Audience/Debaters/Judges` の翻訳キーを整理し、2言語で用語統一（例: 観客/スピーカー/ジャッジ）。サブナビのアクティブ状態を明確化。文言が長い言語でも崩れない余白/折り返しを確認。
- 対象: `views/user/UserTournament.vue`
- 完了条件: 参加者ナビの翻訳が揃い、言語切替で崩れない。

### タスク 3.4: 翻訳運用ルールの整備
- 目的: 2言語対応の品質を維持し、翻訳漏れを防ぐ。
- 仕様: 翻訳キー命名規則（例: `nav.admin.home` 形式）と表記ガイドを作成し、UI 文言は `$t()` を経由する方針に統一。日付/数値フォーマットはロケール依存にする。
- 対象: 翻訳ファイル/文言全般
- 完了条件: 新規文言追加時に翻訳漏れが発生しない運用が決まる。

### タスク 3.5: ロゴによる初期ページへの遷移
- 目的: UI改善

---

### タスク 4.1: AdminHome の一覧・作成フォーム再設計
- 目的: 大会管理の操作をスムーズにする。
- 仕様: 大会一覧をテーブル化し、検索（大会名/ID）を追加。作成フォームは `Field` を使用し、必須項目を明示。削除は確認ダイアログの文言を統一。
- 対象: `views/admin/AdminHome.vue`
- 完了条件: 大会検索が可能で、作成/編集/削除の導線が明確。

### タスク 4.2: エンティティ管理の一覧・入力改善
- 目的: Teams/Adjudicators/Venues/Speakers/Institutions を扱いやすくする。
- 仕様: 各エンティティに検索欄を追加し、一覧はページングまたは簡易「もっと見る」を付ける。CSV import はセクションを分け、サンプルフォーマット説明を追加する。
- 対象: `views/admin/AdminTournamentHome.vue`
- 完了条件: 大量データでも見失わず、入力/CSV操作が分かりやすい。

### タスク 4.3: Rounds の一覧・編集 UI 改善
- 目的: ラウンド編集の可視性と誤操作防止を強化する。
- 仕様: 一覧をテーブル化し、ラウンド番号/名称/公開状態を列表示。編集はモーダルまたはサイドパネルで行い、保存/取消を明示する。
- 対象: `views/admin/AdminTournamentRounds.vue`
- 完了条件: 編集操作が「今どのラウンドを編集しているか」明確になる。

### タスク 4.4: Submissions の閲覧 UI 改善
- 目的: 提出情報を把握しやすくする。
- 仕様: フィルタバーを固定し、検索（submittedBy/ID）を追加。一覧はテーブル化し、詳細 JSON は折り畳みで表示。チャートは「表示/非表示」切替を可能にする。
- 対象: `views/admin/AdminTournamentSubmissions.vue`
- 完了条件: 目的の提出情報に素早く到達できる。

### タスク 4.5: ResultsEditor の構造化
- 目的: JSON 編集の負荷を下げ、誤入力を減らす。
- 仕様: 既知の `standings` 構造を検知できる場合はテーブル編集に切替。未対応の場合は JSON 編集を残し、バリデーションと整形ボタンを提供する。
- 対象: `components/results/ResultsEditor.vue`
- 完了条件: JSON 直接編集が必須でなくなる。

### タスク 4.6: 参加者向け大会一覧の改善
- 目的: 公開中大会を探しやすくする。
- 仕様: 大会名検索とシンプルなカード/テーブル切替を追加。公開ステータスや開催情報がある場合は表示欄を追加。
- 対象: `views/user/UserHome.vue`
- 完了条件: 大会選択が直感的になる。

---

### タスク 5.1: チャートの文言・配色統一
- 目的: 日本語 UI と整合するグラフ表示を実現する。
- 仕様: すべてのチャートタイトル/軸ラベル/凡例を翻訳キー化。色はデザイントークンに揃え、凡例位置と余白を統一。2言語切替でラベルが更新されることを確認。
- 対象: `components/mstat/*`
- 完了条件: チャート文言が日本語で統一される。

### タスク 5.2: SlideShow 操作性改善
- 目的: 発表用途での使いやすさを向上する。
- 仕様: 左右キーでスライド移動、Esc で閉じる。ページ数が0の場合は空状態表示。クローズボタンを常に表示。
- 対象: `components/slides/SlideShow.vue`
- 完了条件: キーボード操作でスライドが動く。

### タスク 5.3: Compiled Results の操作 UI 改善
- 目的: ラウンド選択やスライド表示の混乱を防ぐ。
- 仕様: ラウンド選択をチェックボックスまたはタグ式セレクタに置換。スライド表示の設定を折り畳みセクションに移動。
- 対象: `views/admin/AdminTournamentCompiled.vue`
- 完了条件: 複数ラウンド選択の手順が直感的になる。

---

### タスク 6.1: アクセシビリティ基盤
- 目的: キーボード操作と視認性を担保する。
- 仕様: すべての操作要素にフォーカスリングを付与。アイコンボタンには `aria-label` を設定。フォームは `label` と `id` を必ず紐付ける。
- 対象: 共通コンポーネントと主要画面
- 完了条件: Tab 移動で操作可能、スクリーンリーダーでラベルが読める。

### タスク 6.2: QA チェックリスト作成
- 目的: リリース品質を担保する。
- 仕様: 主要画面の確認項目（表示崩れ/エラー表示/入力バリデーション/モバイル）をチェックリスト化。
- 成果物: `docs/ui-qa-checklist.md`
- 完了条件: レビュー担当がチェックに使える一覧が完成。

---

## ステップ 1: 現状調査・インベントリ作成
### 目的
- UI コンポーネント/画面の「どこが古い/不便か」を可視化し、改修単位を切り出す。

### 作業内容
- 画面一覧とユースケースを整理（管理/参加者/ログイン）
- UI 部品の重複パターンを抽出（ボタン、入力、カード、一覧）
- 既存 UI の問題点を一覧化（スタイル揺れ、英日混在、操作性）

### 変更対象（参考）
- `packages/web/src/views/*`
- `packages/web/src/components/common/*`
- `packages/web/src/styles.css`

### 成果物
- 画面マップ（簡易）
- UI コンポーネント棚卸し表
- 問題点リスト（優先度つき）

---

## ステップ 2: デザイン基盤（デザインシステム/トークン）構築
### 目的
- UI の一貫性を担保し、今後の変更を高速化する。

### 作業内容
- CSS トークン（色/余白/角丸/フォント/影）を `styles.css` に定義
- 共通 UI コンポーネントを追加/置き換え
  - `Button`（primary/secondary/ghost/danger）
  - `Field`（label+input/select/textarea）
  - `Card` / `Section` / `Table`
- 既存の `.primary`, `.ghost` 等を共通部品に寄せる

### 変更対象
- `packages/web/src/styles.css`
- `packages/web/src/components/common/*`
- 既存ビューのフォーム/ボタン実装

### 成果物
- UI コンポーネント仕様書（props と状態）
- 共通 CSS トークン

---

## ステップ 3: 情報設計（ナビ/レイアウト）再設計
### 目的
- 画面構成を分かりやすくし、迷わない UI を作る。

### 作業内容
- 管理画面の情報整理
  - 大会設定 / 参加者管理 / ラウンド / 提出 / 集計 / 結果 を明確に分離
  - 長大な単一画面を「タブ化/折り畳み/セクション分割」
- 参加者画面のナビを改善
  - 現在地の強調
  - 英語ラベルの統一（日本語化 or 役割名を統一）
- ヘッダーに現在地表示/パンくず追加を検討
- 左上のロゴをクリックして初期ページに飛ぶ

### 変更対象
- `packages/web/src/components/common/AppHeader.vue`
- `packages/web/src/views/admin/*`
- `packages/web/src/views/user/*`

### 成果物
- 新しい IA（情報設計）図
- ナビゲーション仕様（リンク、階層、現在地表示）

---

## ステップ 4: フォーム/一覧/表の再設計
### 目的
- 操作の分かりやすさを向上し、ミスを減らす。

### 作業内容
- すべての入力にラベルを付与（プレースホルダ依存を排除）
- JSON 直接編集を廃止し、構造化フォームへ移行
- 一覧に検索/フィルタ/ページングを導入
- 確認ダイアログ/削除導線を統一

### 変更対象
- `packages/web/src/views/admin/AdminTournamentHome.vue`
- `packages/web/src/views/admin/AdminTournamentRounds.vue`
- `packages/web/src/views/admin/AdminTournamentSubmissions.vue`
- `packages/web/src/components/results/ResultsEditor.vue`
- `packages/web/src/views/admin/AdminHome.vue`
- `packages/web/src/views/user/UserHome.vue`

### 成果物
- フォームコンポーネント化
- 一覧 UI ガイドライン（検索/フィルタ/ページング）

---

## ステップ 5: データ視覚化の再設計
### 目的
- 統計や結果を「理解しやすく、見やすい」形で提示する。

### 作業内容
- グラフタイトル/ラベルを UI 言語に統一
- 視覚的な情報量を調整（凡例/色/余白）
- `SlideShow` の操作性改善（キーボード操作、空状態）

### 変更対象
- `packages/web/src/components/mstat/*`
- `packages/web/src/components/slides/*`
- `packages/web/src/views/admin/AdminTournamentCompiled.vue`

### 成果物
- 可視化 UI 仕様書
- グラフ/スライド UI の改善実装

---

## ステップ 6: アクセシビリティ・品質検証・段階的リリース
### 目的
- 安定した UI をリリースし、運用で破綻しないことを保証する。

### 作業内容
- キーボード操作/フォーカス可視化/ARIA の基本対応
- 代表的な画面で簡易 UX テスト
- 既存ユーザーからのフィードバックを反映するため段階的にリリース

### 変更対象
- 主要 UI コンポーネント全般

### 成果物
- QA チェックリスト
- 改修リリース手順書

---

## 実装優先度（提案）
1. 共通 UI コンポーネントとフォーム改善（ステップ 2 + 4）
2. 管理画面の情報設計改善（ステップ 3）
3. データ視覚化の改善（ステップ 5）
4. アクセシビリティ/品質検証（ステップ 6）

---

## 進め方
- ステップ 1〜2 を最初に実施し、共通基盤を固めてから各画面を改修する。
- 各ステップの成果物をレビューし、承認後に次ステップへ進む。

---

## 補足
- 具体的な UI デザイン（色/フォント/レイアウト）は、ステップ 2 の段階で決定する。
- 画面数が多いので、段階的にスプリント化するのが望ましい。

---

## 作業手順（実装順・依存関係を含む）
以下は実務担当がそのまま着手できる順序。依存関係のあるタスクは前後を固定する。

### 手順 0: 事前準備
- 目的: 作業ブランチ/レビュー方法/デザイン決定フローを確定する。
- 手順:
  1. 作業用ブランチ作成とレビュー担当の確定。
  2. UI 言語方針（2言語のトーン/用語統一/翻訳運用）を確定。
  3. 主要導線（大会作成/ラウンド編集/結果閲覧）を対象スコープとして合意。
- 完了条件: 改修の前提（言語/範囲/レビュー方法）が合意されている。

### 手順 1: 現状把握（タスク 1.1〜1.3）
- 目的: 影響範囲の把握と優先順位の確定。
- 手順:
  1. 画面マップと主要フローを作成。
  2. UI コンポーネント棚卸しを作成。
  3. 問題点一覧を作成し、優先度を付与。
- 依存: なし
- 完了条件: `docs/ui-map.md` `docs/ui-inventory.md` `docs/ui-issues.md` が揃う。

### 手順 2: デザイン基盤の実装（タスク 2.1〜2.5）
- 目的: 共通スタイル・共通 UI を先に固める。
- 手順:
  1. CSS トークンを `styles.css` に導入。
  2. レイアウト基盤（page/container/stack）を追加。
  3. Button/Field/List/Table/EmptyState を共通化。
  4. 既存の `.primary/.ghost` を段階的に置換。
- 依存: 手順 1 完了
- 完了条件: 主要 UI が共通コンポーネントで再利用可能。

### 手順 3: 情報設計の再設計（タスク 3.1〜3.3）
- 目的: 画面構成とナビの迷いを解消する。
- 手順:
  1. AppHeader の現在地表示とレスポンシブ対応。
  2. 管理画面のセクション分割方針を適用。
  3. 参加者画面の役割ラベルを統一。
- 依存: 手順 2（Button/Field/Container 反映済）
- 完了条件: ナビ構造が整理され、UI 言語が統一される。

### 手順 4: フォーム・一覧・表の改善（タスク 4.1〜4.6）
- 目的: 操作性を改善し誤操作を減らす。
- 手順:
  1. AdminHome の作成フォーム・一覧を再設計。
  2. エンティティ管理に検索/一覧改善を追加。
  3. Rounds 編集 UI をモーダル化/明確化。
  4. Submissions の一覧・詳細表示を改善。
  5. ResultsEditor を構造化フォームに移行。
  6. 参加者大会一覧を検索可能にする。
- 依存: 手順 2, 3
- 完了条件: 主要フォームと一覧の UI が統一される。

### 手順 5: 可視化 UI の改善（タスク 5.1〜5.3）
- 目的: 結果/統計の理解容易性を高める。
- 手順:
  1. チャート文言・配色を統一。
  2. SlideShow 操作性改善（キーボード/空状態）。
  3. Compiled Results の選択 UI を改善。
- 依存: 手順 2
- 完了条件: チャートとスライドの操作性が向上する。

### 手順 6: アクセシビリティと QA（タスク 6.1〜6.2）
- 目的: 品質担保と運用安定化。
- 手順:
  1. フォーカスリング・ARIA を適用。
  2. QA チェックリスト作成と確認。
- 依存: 手順 4, 5 完了後
- 完了条件: チェックリストが完成し主要画面でQA完了。

---

## 作業チェックリスト

### チェックリスト 1: 現状把握
- [x] `docs/ui-map.md` を作成した
- [x] `docs/ui-inventory.md` を作成した
- [x] `docs/ui-issues.md` を作成した
- [x] 問題点に P0/P1/P2 の優先度を付与した

### チェックリスト 2: デザイン基盤
- [x] `styles.css` に CSS トークンを追加した
- [x] 最大幅と余白の基盤（page/container）が適用された
- [x] 共通 `Button` を追加した
- [x] 共通 `Field` を追加した
- [x] 共通 `List`/`Table`/`EmptyState` を追加した
- [x] `.primary`/`.ghost` の直書きを置換した

### チェックリスト 3: 情報設計
- [x] AppHeader で現在地の強調が表示される
- [x] AppHeader が狭幅で崩れない
- [x] 管理画面のセクションが分割されている
- [x] 参加者ナビの翻訳が揃い、言語切替で崩れない
- [x] 左上のロゴでトップページに飛ぶ

### チェックリスト 4: フォーム/一覧/表
- [x] AdminHome の一覧に検索がある
- [x] エンティティ管理に検索/ページングがある
- [x] Rounds 編集がモーダルまたは専用領域に分離されている
- [x] Submissions の詳細 JSON が折り畳み表示になっている
- [x] ResultsEditor が構造化編集に対応している
- [x] 参加者大会一覧に検索がある

### チェックリスト 5: 可視化
- [x] グラフの文言が翻訳キー化されている
- [x] グラフの配色がデザイントークンに統一されている
- [x] SlideShow がキーボード操作に対応している
- [x] Compiled Results のラウンド選択 UI が直感的になっている

### チェックリスト 6: 2言語対応
- [x] 主要画面の文言が `$t()` 経由になっている
- [x] 翻訳漏れがない（管理/参加者/ログイン）
- [x] 言語切替で文言・日付・数値が整合する

### チェックリスト 6: アクセシビリティ/QA
- [x] 主要ボタン/リンクにフォーカスリングがある
- [x] アイコンボタンに `aria-label` がある
- [x] 全フォーム入力に `label` が紐付いている
- [x] `docs/ui-qa-checklist.md` を作成した
