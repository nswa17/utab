# Tabシステム更新要望 ロードマップ（2026-02-08）

## 0. 前提
- この検討は、現行実装（`/Users/neon/Desktop/utab`）をベースにしています。
- 優先順位は「コアロジック（配席/集計順位アルゴリズム）を変更しないもの」を最上位にしています。
- 「要検討」は、仕様確定が必要なもの・コアロジック変更が必要なもの・Tab内実装が必須ではないものを分けています。

## 1. 判定サマリ

### 1-1. 先行実装（コア変更なし・短期）
1. [x] `CSV compile` の序数表記統一（`21th -> 21st`）
2. [x] `allocation` 画面の待機リスト（配置済み/非available）の折りたたみ・非表示
3. [x] `allocation` の公開前プレビュー（部屋順 / Win順）
4. [x] `Result/Submissions` 画面での表示改善（サイド/チーム/スピーカー順・件数可視化）
5. [x] 表彰者のコピー用フォーマット出力
6. [x] 事前CSVの拡張（ジャッジ availability・基本 conflict 列）

> 2026-02-08 完了記録: 上記 `1-1` の6項目を先行実装済み（`T07` は対象外）。

### 1-2. 非コアだが中工数（要件確定後）
1. 提出済みバロットの名前変更・追加（Submission編集API追加）
2. ジャッジ組み合わせのラウンド別インポート
3. 引き分け時の結果表示（勝敗点の定義が必要）
4. 「内容/表現」の分離入力・修正UI（現行 `Matter/Manner` との整合）
5. 同一名二重入力時の平均化/賞点正規化（2人チーム・PD4）

### 1-3. コアロジック変更が必要（要検討）
1. ランキング優先度の可変化（`win/sum/margin/sd` の優先順位設定）
2. auto allocation の新要素（同校サイド分散、同校別チーム対戦履歴回避、地域分散）
3. conflict種別（チーム/学校/都道府県）と重み付け優先度の導入

### 1-4. Tab内導入の必要性を要検討（外部連携推奨）
1. 送信メール控え（SMTP/個人情報管理が必要）
2. コメントシート収集→PDF化→メール送信
3. 賞状自動生成
4. 参加証明書作成/送付

### 1-5. 取りこぼし再点検（2026-02-08）
- 元要望の列挙項目を再照合し、`R01` から `R21` までの対応先は全件マッピング済み（未割当なし）。

## 2. 要望別トリアージ

| ID | 要望 | 可否 | 優先度 | 難易度 | コア変更 | 判定 |
| --- | --- | --- | --- | --- | --- | --- |
| R01 | バロット送信内容のメール控え | 条件付き可 | P2 | L | なし | SMTP/宛先管理追加が必要。Tab内必須ではないため要検討 |
| R02 | CSV compile 序数表記修正 | 可 | P0 | S | なし | 先行対応 |
| R03 | ランキング指標の並び替え/優先度設定 | 可 | P2 | L | あり | 集計比較ロジック変更のため要検討 |
| R04 | 引き分けでもランキング表示 | 可 | P1 | M | 軽微 | 勝敗点の定義（0.5/0/別軸）要決定 |
| R05 | 提出済みバロットの名前変更・追加 | 可 | P1 | M | なし | Submission更新API追加で対応 |
| R06 | 提出済みバロットにサイド/チーム/順序表示 | 可 | P0 | M | なし | UI拡張で対応 |
| R07 | 同名二重入力時の平均化・賞0/1化 | 可 | P1 | M-L | 軽微 | compile変換ロジックの仕様追加 |
| R08 | 点数表示を内容/表現に分離し修正 | 可 | P2 | M | 軽微 | 既存Matter/Mannerとの仕様統一が必要 |
| R09 | 勝敗/スコアのバロット数可視化・整列 | 可 | P0 | S-M | なし | 先行対応 |
| R10 | 勝敗のみ運用で部屋順「A vs B X-Y」表示 | 可 | P0 | S-M | なし | 先行対応 |
| R11 | conflict一括CSV（学校/都道府県/優先度） | 条件付き可 | P2 | L | あり | データモデル再設計が必要 |
| R12 | ジャッジavailabilityをCSV入力時設定 | 可 | P0 | S-M | なし | 先行対応 |
| R13 | ジャッジ組み合わせのラウンド別インプット | 可 | P1 | M | なし | Draw取込UI/APIを追加 |
| R14 | allocation下部リストの非表示/縮小 | 可 | P0 | S | なし | 先行対応 |
| R15 | allocation公開前preview（部屋順/Win順） | 可 | P0 | M | なし | 先行対応 |
| R16 | auto allocation要素追加（3点） | 可 | P2 | L-XL | あり | team filter/データ拡張が必要 |
| R17 | 表彰者コピー（名前+チーム+回数） | 可 | P0 | S | なし | 先行対応 |
| R18 | コメントシート入力→送信 | 条件付き可 | P3 | XL | なし | 外部運用（GAS）継続が現実的 |
| R19 | 賞状自動生成 | 条件付き可 | P3 | XL | なし | Tab外の文書生成基盤が必要 |
| R20 | 参加証明書の自動生成/送付 | 条件付き可 | P3 | XL | なし | Tab外の文書生成基盤が必要 |
| R21 | 100チーム超＋評価入力時の耐性確認 | 可 | P0 | M | なし | 負荷試験とRateLimit調整を先行 |

## 3. フェーズ別ロードマップ（未完了分は PLAN へ移動）

未完了の実装タスク（`T07`〜）とブロッカーは `../../PLAN.md` に集約しました。
